---
layout:	post
title:	"Command line น่ารู้ #1"
date:	2019-08-12
tags: [powershell, mac osx, cli]
---

  แน่นอนครับว่าด้วยเทคโนโลยีจอภาพปัจจุบัน มันทำให้ส่วนติดต่อกับผู้ใช้น่าดึงดูดและน่าสนใจมากขึ้นสำหรับ End user แต่แน่นอนว่าสำหรับพวกเราเหล่า Power User (เอ๊ะ มี End user หลงมารึเปล่านะ) ก็จะพบว่าการใช้งาน GUI เป็นแค่เปลือกที่ปิดกั้นเราจากความสามารถที่แท้จริงของคอมพิวเตอร์ก็เท่านั้น

![](/assets/images/migrated/1_2AN_pnRm2Xk1MQ-Zni0lbg.jpeg)เมื่อเราต้องเจอกับบางงานที่จะต้องทำอย่าง automated เราก็จะต้องมามือเปื้อนกับคำสั่งใน Command line บ้าง ขอออกตัวก่อนว่าไม่ใช่เป็นนักเขียนสคริปต์ตัวยง แต่บางคำสั่งก็ดูมีประโยชน์ในแง่ทั้งการเขียนสคริปต์ หรือช่วยให้เราแก้ปัญหาหน้างานได้เร็วขึ้น โพสต์นี้ขอเป็นที่รวบรวมคำสั่งแปลก ๆ ที่ไม่เคยเจอมาไว้ในซี่รี่ย์ “Command line น่ารู้” ครับ

### fs_usage (macOS)

เจอในบทความของฝรั่งในการค้นหาไฟล์บางอย่างที่เราเพิ่งใช้งาน เช่น ตอนที่ประสบปัญหา คือ เราไม่แน่ใจว่า my.cnf ตัวไหนถูกโหลดขึ้นมาใช้งาน คุณฝรั่งที่เขียนบทความนั้นก็ใช้วิธีรัน MySQL Server ขึ้นมาเลยจ้า แล้วก็ทำการ grep ดูผลลัพธ์จากคำสั่งนี้ (หาคำว่า my.cnf) ปรากฏว่า ง่ายเหมือนปอกกล้วยเข้าปากเลยครับ

เวลารันคำสั่งนี้ต้องเป็น Super User นะครับ ตัวอย่างก็ประมาณนี้

```
sudo fs_usage | grep my.cnf
```

### **ForFiles (Windows)**

เมื่อครั้งที่พยายามจะทำ Backup ของ MySQL ผมก็พยายามจะ dump ฐานข้อมูลออกมาวางไว้ที่โฟลเดอร์หนึ่ง ๆ ใช่ไหมครับ แล้วข้อมูลตรงนั้นจะเอาไปเก็บรักษาไว้อย่างไรก็สุดแล้วแต่ แต่ถ้าหากเราคิดยาวไปช็อตต่อไป เราก็จะจินตนาการได้ว่าสักวันหนึ่งตัวไฟล์ Backup นี้จะเต็มไปด้วยไฟล์ข้อมูลเก่า ๆ ที่อาจจะถูกแทนที่ด้วยข้อมูลใหม่ ๆ หรือว่าข้อมูลเก่า ๆ นั้นมันไม่มีประโยชน์ที่จะเก็บแล้ว

ส่วนตัวแวบแรกขึ้นมา ก็คิดถึงแนวคิดของ logrotate ในฝั่ง Linux เค้า แต่ทีนี้เหมือนกับว่ามันก็ไม่ได้ตอบโจทย์เราซะทีเดียว เพราะของ logrotate มันจะอารมณ์แบบว่ามีไฟล์ที่ยาว ๆ ไฟล์นึง แล้วมันก็จะตัดไฟล์ออกมาแล้วก็ zip เก็บไว้ให้ และถ้าเก่า ๆ เกินไปมันก็จะลบทิ้งให้ (+config มากมายละเอียดยิบ ถูกออกแบบมารันเป็น cronjob ด้วย) ซึ่งจริง ๆ มันก็เกินความต้องการของเราไปมาก และ implementation ของ logrotate บน Windows ก็ต้องลงโปรแกรมเสริมอีก ซึ่งไม่ต้องการอย่างนั้น

ปรากฏว่าบน Windows มีคำสั่ง [ForFiles](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/forfiles) คือเราสามารถที่จะระบุพารามิเตอร์เป็นวันที่ก็ได้ หรือจะระบุเป็น Pattern ของไฟล์ ทีนี้เราก็ระบุไปได้เลยครับว่าแต่ละไฟล์ตามเงื่อนไขเราจะทำอะไรกับมัน…

```
forfiles /s /m *.* /d -365 /c "cmd /c echo [@file](http://twitter.com/file "Twitter profile for @file") is at least one year old."
```

ตัวอย่างนี้ก็คือหาไฟล์ทุกไฟล์ (รวมถึง Subdirectories) โดยหาไฟล์ที่เก่ากว่า 365 วันแล้วก็ฟ้องซะ อย่างถ้าสำหรับโจทย์ที่ผมกำลังจะทำ ก็สั่งลบไฟล์ได้รายตัวเลยครับ

ช่วงนี้รู้ใหม่มาแค่นี้ ถ้ามีเวลาเดี๋ยวจะลองเอา Power Shell เก่า ๆ ที่เคยปะติดปะต่อเอาไว้มาเล่าให้ฟังนะครับว่าใช้คำสั่งอะไรมาตอบโจทย์งานอะไรบ้าง

สวัสดี

  